// stores/sessionStore.ts
import { defineStore } from "pinia";

interface SessionVariables {
  directoryRule: string;
  teacherRule: string;
}
let directoryRule =
  "ä½ éœ€è¦ä¸ºæ¯ä¸ªç« èŠ‚å’Œå°èŠ‚ç”Ÿæˆä¸€ä¸ªå¤§è‡´çº²è¦ï¼Œæè¿°è¯¥å°èŠ‚çš„ä¸»è¦å†…å®¹éœ€è¦è¯¦ç»†ä¸€ç‚¹ã€‚\n" +
  "  \n" +
  '  "è¦æ±‚": {\n' +
  "    \n" +
  '    "å¤„ç†è§„åˆ™": [\n' +
  '      "1. ä¿ç•™åŸå§‹æ–‡æœ¬ä¸­çš„ç« èŠ‚ç¼–å·å’Œåç§°ï¼ˆå¦‚ã€ç¬¬1ç« XXXã€ã€ã€2.3.1 YYYã€ï¼‰",\n' +
  '      "2. åŒ…å«æ‰€æœ‰å±‚çº§çš„æ ‡é¢˜ï¼ˆç« ã€èŠ‚ã€å°èŠ‚ï¼‰",\n' +
  '      "3. æå–æ ‡é¢˜æ–‡æœ¬ï¼Œå¹¶ä¸”è§£é‡Šå†…å®¹,å’Œæå–è¿™ä¸ªå°èŠ‚çš„å¤§è‡´å†…å®¹",\n' +
  '      "4. å®Œå…¨ä¿ç•™ä¸­æ–‡æ ‡ç‚¹å’Œæ•°å­—ç¼–å·æ ¼å¼",\n' +
  '      "5. ç¡®ä¿JSONè¯­æ³•æ­£ç¡®ï¼Œæ— é‡å¤é¡¹"\n' +
  "    ],\n" +
  '    "ç¤ºä¾‹è¾“å‡ºå¦‚ä¸‹" [\n' +
  '      "ç¬¬1ç« è®¡ç®—æœºç³»ç»Ÿæ¦‚è®º",\n' +
  '      "1.1è®¡ç®—æœºç³»ç»Ÿç®€ä»‹", \n' +
  '      "1.1.1 è®¡ç®—æœºçš„è½¯ç¡¬ä»¶æ¦‚å¿µ:è§£é‡Šäº†è®¡ç®—æœºç³»ç»Ÿçš„ç¡¬ä»¶å’Œè½¯ä»¶çš„æ¦‚å¿µã€‚ç¡¬ä»¶æ˜¯è®¡ç®—æœºçš„å®ä½“éƒ¨åˆ†ï¼ŒåŒ…æ‹¬ç”µå­å…ƒå™¨ä»¶å’Œæœºæ¢°è®¾å¤‡ï¼›è½¯ä»¶åˆ™æ˜¯ç”±ç¨‹åºç»„æˆï¼Œç”¨äºæŒ‡å¯¼è®¡ç®—æœºæ‰§è¡Œå„ç§ä»»åŠ¡ã€‚å¼ºè°ƒäº†è½¯ä»¶çš„é‡è¦æ€§ï¼Œå°¤å…¶æ˜¯åœ¨æé«˜è®¡ç®—æœºæ€§èƒ½å’Œå®ç°äººç±»æ€ç»´æ¨¡æ‹Ÿæ–¹é¢çš„ä½œç”¨ã€‚",\n' +
  '      "1.1.2 è®¡ç®—æœºç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„:æè¿°äº†è®¡ç®—æœºç³»ç»Ÿçš„å¤šçº§å±‚æ¬¡ç»“æ„ï¼Œä»å®é™…æœºå™¨ï¼ˆM1ï¼‰åˆ°è™šæ‹Ÿæœºï¼ˆM2ã€M3ã€M4ï¼‰ï¼Œå†åˆ°åº”ç”¨è¯­è¨€è™šæ‹Ÿæœºã€‚ä»‹ç»äº†ä¸åŒå±‚æ¬¡ç»“æ„å¯¹ç¼–ç¨‹å’Œè®¡ç®—æœºæ€§èƒ½çš„å½±å“ã€‚",\n' +
  '      "ç¬¬2ç« è®¡ç®—æœºçš„å‘å±•åŠåº”ç”¨",\n' +
  '      "2.1è®¡ç®—æœºçš„å‘å±•å²",\n' +
  '      "2.2.2 å·¥ä¸šæ§åˆ¶å’Œå®æ—¶æ§åˆ¶:è®²è§£äº†è®¡ç®—æœºåœ¨å·¥ä¸šæ§åˆ¶å’Œå®æ—¶æ§åˆ¶ç³»ç»Ÿä¸­çš„åº”ç”¨ï¼Œå¦‚è‡ªåŠ¨åŒ–ç”Ÿäº§çº¿ã€å¯¼å¼¹æ§åˆ¶å’Œè½½äººèˆªå¤©ç­‰ã€‚"\n' +
  "    ]\n" +
  "  }";
let teacherRule =
  "ä½ æ˜¯ä¸€åæ‹¥æœ‰15å¹´æ•™å­¦ç»éªŒçš„ç‰¹çº§æ•™å¸ˆï¼Œç°éœ€è¦å‘å­¦ç”Ÿè®²æˆä»¥ä¸‹æ–°çŸ¥è¯†ï¼š\n" +
  "{{ æ’å…¥ç”¨æˆ·æä¾›çš„çŸ¥è¯†å†…å®¹ }}\n" +
  "\n" +
  "è¯·æŒ‰é»„é‡‘æ•™å­¦æ¡†æ¶æ‹†è§£ä¸è®²è§£ï¼š\n" +
  "\n" +
  "**1. æ˜¯ä»€ä¹ˆï½œæ¦‚å¿µç ´å†°**\n" +
  "- ç”¨ã€Œç”Ÿæ´»ç°è±¡ç±»æ¯”æ³•ã€å®šä¹‰æ ¸å¿ƒæ¦‚å¿µï¼ˆä¾‹ï¼šå°†ç”µæµæ¯”å–»ä¸ºé«˜é€Ÿå…¬è·¯è½¦æµï¼‰\n" +
  "- å¯¹æ¯”æ˜“æ··æ·†æ¦‚å¿µï¼Œç”¨è¡¨æ ¼å‘ˆç°å·®å¼‚ç‚¹ï¼ˆå¦‚ï¼šå…‰åˆä½œç”¨ vs å‘¼å¸ä½œç”¨ï¼‰\n" +
  "\n" +
  "**2. ä¸ºä»€ä¹ˆï½œä»·å€¼å…±é¸£**\n" +
  "- ç»“åˆå†å²æ•…äº‹/ç°å®æ¡ˆä¾‹è¯´æ˜å­¦ä¹ å¿…è¦æ€§\n" +
  "  ï¼ˆä¾‹ï¼šé—¨æ·åˆ—å¤«æ¢¦åˆ°è›‡å’¬å°¾å·´â†’å…ƒç´ å‘¨æœŸè¡¨è¯ç”Ÿâ†’æ¨åŠ¨åŒ–å­¦é©å‘½ï¼‰\n" +
  "- æé—®å¼•å‘æ€è€ƒï¼š_â€œå¦‚æœä¸æ‡‚è¿™ä¸ªçŸ¥è¯†ï¼Œæœªæ¥å¯èƒ½é‡åˆ°ä»€ä¹ˆå›°å¢ƒï¼Ÿâ€_\n" +
  "\n" +
  "**3. æ€ä¹ˆåšï½œæ–¹æ³•è®ºå·¥å…·ç®±**\n" +
  "- åˆ†æ­¥éª¤æ¼”ç¤ºåº”ç”¨æµç¨‹ï¼ˆç¤ºä¾‹ä»£ç /æ•°å­¦é¢˜åˆ†æ­¥è§£æï¼‰\n" +
  "- æç‚¼3-5ä¸ªè®°å¿†å£è¯€ï¼ˆå¦‚ï¼šä¸‰è§’å‡½æ•°å…¬å¼é€Ÿè®°æ³•ï¼‰\n" +
  "- è®¾è®¡1åˆ†é’Ÿéšå ‚å°æµ‹è¯•ï¼ˆå•é€‰+åˆ¤æ–­æ­£è¯¯ï¼‰\n" +
  "\n" +
  "**4. æœ‰ä»€ä¹ˆç”¨ï½œçŸ¥è¯†åœ°å›¾é”šå®š**\n" +
  "- å…³è”ä¸Šä¸‹æ¸¸çŸ¥è¯†ç‚¹ï¼ˆç”¨æ€ç»´å¯¼å›¾è¯´æ˜çŸ¥è¯†ä½“ç³»ä½ç½®ï¼‰\n" +
  "- åˆ—ä¸¾èŒä¸šåœºæ™¯åº”ç”¨ï¼ˆå¦‚ï¼šç¼–ç¨‹ç®—æ³•â†’è‡ªåŠ¨é©¾é©¶è·¯å¾„è§„åˆ’ï¼‰\n" +
  "\n" +
  "**â–Œè¡¨è¾¾è¦æ±‚**\n" +
  "â‘  åº”è¯¥æŠŠæ•™å­¦æ¡†æ¶è¡”æ¥å¥½,ä¸è¦å¾ˆç”Ÿç¡¬çš„è¡”æ¥\n" +
  "â‘¡ å…³é”®ç»“è®ºç”¨å½©è‰²emojiå¼ºåŒ–ï¼ˆå¦‚ï¼šâœ… â—ğŸŒ¿ â¡ï¸ï¼‰\n" +
  "â‘¢ è¯­è¨€é£æ ¼ï¼šäº²åˆ‡å¦‚é¢å¯¹é¢è¾…å¯¼";
export const useSessionStore = defineStore("session", {
  state: () => ({
    sessions: new Map<string, SessionVariables>(),
    // ä¿®æ”¹åçš„é»˜è®¤è§„åˆ™
    defaultRules: {
      directoryRule: directoryRule,

      teacherRule: teacherRule,
    },
  }),
  actions: {
    // è·å–æˆ–åˆ›å»ºä¼šè¯å˜é‡
    getSessionVariables(sessionId: string): SessionVariables {
      if (!this.sessions.has(sessionId)) {
        // ç§»é™¤IDæ›¿æ¢é€»è¾‘
        this.sessions.set(sessionId, {
          ...this.defaultRules,
        });
        this.saveToLocal();
      }
      return this.sessions.get(sessionId)!;
    },

    updateVariables(sessionId: string, variables: SessionVariables) {
      // ç›´æ¥è¦†ç›–å­˜å‚¨çš„å˜é‡å¯¹è±¡
      this.sessions.set(sessionId, {
        directoryRule: variables.directoryRule,
        teacherRule: variables.teacherRule,
      });
      this.saveToLocal();
    },

    // æŒä¹…åŒ–å­˜å‚¨
    saveToLocal() {
      const serialized = JSON.stringify(Array.from(this.sessions.entries()));
      localStorage.setItem("session-store", serialized);
    },

    // åˆå§‹åŒ–å­˜å‚¨
    initFromLocal() {
      const localData = localStorage.getItem("session-store");
      if (localData) {
        try {
          const parsed = JSON.parse(localData);
          this.sessions = new Map(parsed);
        } catch (e) {
          localStorage.removeItem("session-store");
        }
      }
    },
  },
});
